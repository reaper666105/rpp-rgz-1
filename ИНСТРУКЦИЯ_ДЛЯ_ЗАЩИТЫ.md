# Инструкция для защиты РГЗ (Вариант 12)

## Что демонстрировать на защите

### 1. Общая информация об API
- Показать корневой эндпоинт `GET /` - информацию об API
- Показать health check `GET /health` - проверка подключения к БД

### 2. CRUD операции с товарами

#### 2.1. Создание товара
```powershell
$body = '{"name":"Клавиатура","quantity":10,"price":2500.50,"category":"электроника"}'
curl.exe -X POST http://127.0.0.1:5000/items -H "Content-Type: application/json" -d $body
```

**Что показать:**
- Успешное создание товара (статус 201)
- Валидацию данных (попробовать отрицательное количество или нулевую цену)

#### 2.2. Получение списка товаров
```powershell
# Все товары
curl.exe http://127.0.0.1:5000/items

# Фильтр по категории
curl.exe "http://127.0.0.1:5000/items?category=электроника"
```

**Что показать:**
- Список всех товаров
- Фильтрацию по категории

#### 2.3. Получение конкретного товара
```powershell
curl.exe http://127.0.0.1:5000/items/1
```

**Что показать:**
- Получение товара по ID
- Обработку ошибки 404 для несуществующего товара

#### 2.4. Обновление товара
```powershell
$body = '{"quantity":8}'
curl.exe -X PUT http://127.0.0.1:5000/items/1 -H "Content-Type: application/json" -d $body
```

**Что показать:**
- Частичное обновление (можно обновить только одно поле)
- Полное обновление (несколько полей)

#### 2.5. Удаление товара
```powershell
curl.exe -X DELETE http://127.0.0.1:5000/items/1
```

**Что показать:**
- Успешное удаление (статус 204)
- Попытку удалить несуществующий товар (404)

### 3. Генерация отчётов

#### 3.1. Сводный отчёт в формате JSON
```powershell
curl.exe http://127.0.0.1:5000/reports/summary
```

**Что показать:**
- Общую стоимость всех товаров
- Разбивку по категориям (количество товаров, общее количество единиц, общая стоимость)
- Список товаров с нулевым или отрицательным количеством

#### 3.2. Сводный отчёт в формате CSV
```powershell
curl.exe "http://127.0.0.1:5000/reports/summary?format=csv"
```

**Что показать:**
- Отчёт в формате CSV (удобно для импорта в Excel)

### 4. Валидация данных

**Примеры для демонстрации ошибок:**

```powershell
# Отрицательное количество
$body = '{"name":"Тест","quantity":-1,"price":100,"category":"test"}'
curl.exe -X POST http://127.0.0.1:5000/items -H "Content-Type: application/json" -d $body

# Нулевая цена
$body = '{"name":"Тест","quantity":10,"price":0,"category":"test"}'
curl.exe -X POST http://127.0.0.1:5000/items -H "Content-Type: application/json" -d $body

# Отсутствующие обязательные поля
$body = '{"name":"Тест"}'
curl.exe -X POST http://127.0.0.1:5000/items -H "Content-Type: application/json" -d $body
```

**Что показать:**
- Все проверки валидации работают корректно
- Понятные сообщения об ошибках

### 5. Тестирование и безопасность

#### 5.1. Запуск unit-тестов
```powershell
python -m pytest -q
```

**Что показать:**
- Все тесты проходят успешно
- Покрытие основных сценариев использования

#### 5.2. Проверка безопасности (Bandit)
```powershell
python -m bandit -r app -x tests
```

**Что показать:**
- Отсутствие уязвимостей в коде
- Чистый результат проверки

### 6. GitHub Actions (CI/CD)

**Что показать:**
- Скриншот вкладки Actions в GitHub
- Успешный запуск workflow после push
- Детали выполнения шагов:
  - Установка зависимостей
  - Запуск PostgreSQL
  - Проверка безопасности (Bandit)
  - Запуск тестов (pytest)

### 7. База данных

**Что показать:**
- Использование PostgreSQL (можно показать docker-compose.yml)
- Структуру таблицы items (id, name, quantity, price, category, created_at, updated_at)

## Порядок демонстрации на защите

1. **Введение** (1-2 мин)
   - Показать корневой эндпоинт `/` - описание API
   - Показать health check

2. **Основной функционал** (5-7 мин)
   - Создание товара
   - Получение списка товаров (с фильтрацией)
   - Обновление товара
   - Удаление товара
   - Генерация отчётов (JSON и CSV)

3. **Валидация и обработка ошибок** (2-3 мин)
   - Показать несколько примеров валидации
   - Показать обработку ошибок (404, 400)

4. **Тестирование и CI/CD** (2-3 мин)
   - Запуск тестов локально
   - Показать GitHub Actions workflow
   - Проверка безопасности

5. **Архитектура и технологии** (2-3 мин)
   - Структура проекта
   - Использованные технологии (Flask, PostgreSQL, SQLAlchemy)
   - Модель данных

## Полезные команды для быстрой демонстрации

```powershell
# Быстрая подготовка данных для демонстрации
$items = @(
    '{"name":"Клавиатура","quantity":10,"price":2500.50,"category":"электроника"}',
    '{"name":"Мышь","quantity":5,"price":999.99,"category":"электроника"}',
    '{"name":"Стол","quantity":2,"price":5000,"category":"мебель"}',
    '{"name":"Стул","quantity":0,"price":2000,"category":"мебель"}'
)

foreach ($item in $items) {
    curl.exe -X POST http://127.0.0.1:5000/items -H "Content-Type: application/json" -d $item
    Start-Sleep -Milliseconds 200
}

# Показать список
curl.exe http://127.0.0.1:5000/items

# Показать отчёт
curl.exe http://127.0.0.1:5000/reports/summary
```

## Что подготовить заранее

1. ✅ Запустить PostgreSQL через Docker
2. ✅ Запустить Flask приложение
3. ✅ Подготовить несколько тестовых товаров
4. ✅ Открыть GitHub в браузере (вкладка Actions)
5. ✅ Открыть терминал с готовыми командами curl

## Возможные вопросы на защите

**Q: Почему используется PostgreSQL, а не SQLite?**
A: По требованиям задания (вариант 12) указано использование PostgreSQL. Также это более подходящий выбор для production-окружения.

**Q: Как обеспечивается безопасность API?**
A: Используется Bandit для статического анализа кода, валидация всех входных данных, проверка типов и диапазонов значений.

**Q: Как работает фильтрация по категории?**
A: Используется query-параметр `category` в GET запросе, фильтрация выполняется на уровне SQL через SQLAlchemy.

**Q: Почему отчёты генерируются в двух форматах?**
A: JSON удобен для программной обработки, CSV - для импорта в Excel и других табличных редакторов.

**Q: Как организовано тестирование?**
A: Используется pytest с фикстурами для изоляции тестов, тесты используют отдельную тестовую БД (SQLite локально, PostgreSQL в CI).

